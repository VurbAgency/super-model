<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/polymerfire/firebase-query.html">

<link rel="import" href="sum-model.html">

<dom-module id="sum-models">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
      }

      main {
        padding: 6vw 1rem;
      }

      main>h1 {
        text-align: center;
        text-transform: uppercase;
        color: #B69CC8;
        font-size: 4rem;
      }

      .card {
        min-width: 50vw;
        min-height: 50vh;
      }

      ul.models {
        list-style: none;
        padding: 0;
      }

      ul.models>li {
        padding: 0.5rem;
        font-family: var(--heading-font-stack);
      }

    </style>

    <app-route route="{{route}}" pattern="[[rootPath]]:modelId" data="{{routeData}}" tail="{{subroute}}"></app-route>

    <template is="dom-if" if="[[routeData.modelId]]">

      <sum-model model-id="[[routeData.modelId]]" route="{{subroute}}"></sum-model>

    </template>

    <template is="dom-if" if="[[!routeData.modelId]]">

      <firebase-query id="modelsQuery" path="/models" data="{{models}}"></firebase-query>

      <main>

        <h1>Your SuperModels</h1>

        <div class="card">
          <ul class="models">
            <template is="dom-repeat" items="{{models}}">

              <li>
                <a href="[[route.prefix]]/[[item.$key]]/">{{item.name}}</a>
              </li>

            </template>
          </ul>

          <paper-button on-tap="newModel ">New Model</paper-button>
        </div>

      </main>

    </template>

  </template>

  <script>
    /**
     * `sum-model` Description
     *
     * @summary ShortDescription.
     * @customElement
     * @polymer
     * @extends {Polymer.Element}
     */
    class SumModels extends Polymer.Element {
      /**
       * String providing the tag name to register the element under.
       */
      static get is() {
        return 'sum-models';
      }

      /**
       * Object describing property-related metadata used by Polymer features
       */
      static get properties() {
        return {
          route: Object,
          routeData: Object,
          subroute: Object,
          models: Object
        };
      }

      /**
       * Instance of the element is created/upgraded. Use: initializing state,
       * set up event listeners, create shadow dom.
       * @constructor
       */
      constructor() {
        super();
      }

      /**
       * Use for one-time configuration of your component after local DOM is initialized. 
       */
      ready() {
        super.ready();

        Polymer.RenderStatus.afterNextRender(this, function () {

        });
      }

      newModel() {
        const query = this.shadowRoot.querySelector('firebase-query#modelsQuery')
        const ref = query.ref

        ref.push({
          "name": "Untitled Model",
          "StaffOperatingOtherHumanPrice ": "0 ",
          "averageCustomerLifespan ": "12 ",
          "costInitialCustomer ": "0.01 ",
          "costInitialTech ": "50 ",
          "costMarketingPercentage ": "2 ",
          "costMonthlyTech ": "25 ",
          "costOfficePerHuman ": "550 ",
          "costSoftware ": "1000 ",
          "costSupplies ": "2000 ",
          "discountRate ": "5 ",
          "growthRate ": "2 ",
          "netNewCustomersStart ": "500 ",
          "pricePerMonthT1 ": "0 ",
          "pricePerMonthT2 ": "10 ",
          "pricePerMonthT3 ": "20 ",
          "pricePercentT1 ": "60 ",
          "pricePercentT2 ": "30 ",
          "pricePercentT3 ": "10 ",
          "retentionRateSixMonths ": "50 ",
          "staffDeliveryOtherHumanPrice ": "0 ",
          "staffDeliveryOtherHumans ": "0 ",
          "staffInfrastructureHumanPrice ": "80000 ",
          "staffInfrastructureHumans ": "0.25 ",
          "staffOperatingOtherHumans ": "0 ",
          "staffProductHumanPrice ": "80000 ",
          "staffProductHumans ": "0.25 ",
          "staffServiceHumanPrice ": "80000 ",
          "staffServiceHumans ": "0 ",
          "staffSuccessHumanPrice ": "0 ",
          "staffSuccessHumans ": "0 "
        }
        )
      }

    }

    window.customElements.define(SumModels.is, SumModels);
  </script>
</dom-module>
