<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="shared-styles.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="../bower_components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="sum-customer-tiers-graph.html">
<link rel="import" href="sum-multiple-lines-graph.html">
<link rel="import" href="sum-one-line-graph.html">

<dom-module id="sum-guide">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
        background-color: #F5A6C8;
        display: flex;
        justify-content: center;

        font-size: 1.5vw;
      }

      @media (max-width: 900px) {
        :host {
          font-size: 16px;
        }
      }

      main {
        display: block;
        width: 100%;
        height: 100%;
        /* max-width: 1600px; */
      }

      p {
        max-width: 30em;
        min-width: 16em;
      }

      p.main {
        font-weight: 400;
      }

      .card {
        clear: both;
        padding: 2rem;
        margin-bottom: 64px;
      }



      .intro,
      .retention {
        font-family: 'Montserrat', sans-serif;
      }

      .intro {
        background: linear-gradient(to bottom, #EFF5F9, #C3BCD8, #F5A6C8);
        display: flex;
        flex-wrap: wrap;
        flex-direction: row;
        align-items: center;
      }

      .text {
        padding: 4rem;
        text-align: left;
      }

      @media screen and (max-width: 768px) {
        .card {
          padding: 1rem;
          text-align: center;
          margin: 12px;
        }
      }

      .intro h1 {
        font-weight: 900;
        font-size: 6em;
        text-transform: uppercase;
        line-height: 1;
        color: #2B3990;
      }

      @media screen and (max-width: 768px) {
        .intro h1 {
          font-weight: 600;
          font-size: 4rem;
        }
      }

      .intro p,
      .retention p {
        font-size: 1.5em;
      }

      .intro img {
        padding: 4em;
        width: 50%;
      }

      @media screen and (max-width: 768px) {
        figure,
        img {
          padding: 0;
          max-width: 80vw;
          margin: auto;
        }
        .intro img {
          padding: 1rem;
        }
      }

      div.retention {
        padding: 0 8em 0;
        min-height: 70vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        /* margin-bottom: -24px; */
        /* background: linear-gradient(to bottom, #F5A6C8, #B69CC8, rgba(0, 0, 0, 0)), linear-gradient(to right, #F5A6C8 5%, rgba(0, 0, 0, 0))15%, linear-gradient(-60deg, rgba(0, 0, 0, 0), #B69CC8, rgba(0, 0, 0, 0)); */
        background: linear-gradient(169deg, rgba(0, 0, 0, 0) 87%, #F5A6C8 98%), linear-gradient(to bottom, #F5A6C8, #B69CC8);
      }

      @media screen and (max-width: 768px) {
        div.retention {
          padding: 0 1em 0;
          min-height: 100%;
        }
      }

      div.retention h2 {
        margin-top: 0;
        font-weight: 900;
        font-size: 4em;
        text-transform: uppercase;
        line-height: 1;
        color: #2B3990;
      }

      @media screen and (max-width: 768px) {}

      div.retention img {
        flex: 1;
        min-width: 70vw;
        box-sizing: border-box;
      }

      @media screen and (max-width: 768px) {
        div.retention img {
          min-width: 100%;
          max-width: 100%;
          margin: 10%;
        }
      }

      .card h2 {
        color: #2B3990;
        font-size: 2em;
        margin-top: 0;
        font-weight: 500;
      }

      paper-input[type=number] {
        max-width: 10rem;
      }

      @media screen and (max-width: 768px) {
        paper-input[type=number] {
          margin: auto;
        }
      }

      div.group {
        background: #EFF5F9;
        /* border: 1px solid #2B3990; */
        margin: .5em 1em .5em 0;
        padding: 1em;
        border-radius: 5px;
        flex: 1;
      }

      @media screen and (max-width: 768px) {
        div.group {
          min-width: 100%;
          padding: 16px;
          margin: 8px 0;
          box-sizing: border-box;
        }
      }

      div.group h3 {
        text-align: center;
        font-weight: 400;
        margin: 1rem;
        color: #2B3990;
      }

      div.tiers,
      div.cats {
        display: flex;
        flex-wrap: wrap;
        max-width: 100%;
        box-sizing: border-box;
      }

      .card.with-figure {
        display: flex;
        overflow: hidden;
      }

      .card.with-figure article {
        max-width: 60%;
        flex-wrap: wrap;
        box-sizing: border-box;
      }

      .card.with-figure article,
      .card.with-figure>* {
        flex: 1;
        min-width: 400px;
      }


      @media screen and (max-width: 768px) {
        .card.with-figure article,
        .card.with-figure figure,
        .card.with-figure figure img,
        .card.with-figure>* {
          min-width: 100%;
          max-width: 100%;
          width: 100%;
        }
      }


      .card.with-figure div {
        margin: auto;
      }

      .card.with-figure figure {
        display: flex;
        flex: 1;
        padding: 0;
        margin: 0;
        text-align: right;
        align-self: center;
        max-width: 50%;
      }

      @media screen and (max-width: 768px) {
        .card.with-figure figure {
          padding: 0;
          text-align: center;

        }
      }

      .card.with-figure figure img {
        height: 100%;
        width: 100%;
        margin: 64px;
      }

      #customer-tiers-graph {
        flex: 1;
      }

      .report {
        min-height: 50vh;
        padding: 2rem;
        display: flex;
        flex-direction: row;
        align-items: flex-start;
        color: #2B3990;
        background: linear-gradient(to bottom, #F5A6C8, rgba(239, 245, 249, 1) 12em, #F5A6C8);
        overflow-y: scroll;
      }

      @media screen and (max-width: 768px) {
        .report {
          min-height: 100%;
          padding: 1rem;
        }
      }

      sum-customer-tiers-graph,
      sum-multiple-lines-graph,
      sum-one-line-graph {
        width: 100%;
        /* height: 100%; */
      }

      .report h2 {
        color: #2B3990;
        text-transform: uppercase;
        margin: 2rem 0;
      }

      .report>div {
        padding: 2rem;
        flex: 1;
      }

      .big-number {
        border: 2px solid rgba(239, 245, 249, 1);
        background-color: rgba(239, 245, 249, 0.4);
        border-radius: 4px;
        padding: 1rem;
        text-align: center;
        color: #2B3990;
        /* color: white; */
      }

      .big-number .number {
        font-size: 4em;
        font-family: 'Montserrat', sans-serif;
        margin: 1em;
        min-width: 0;
      }

    </style>

    <main>
      <div class="intro">
        <img src="/src/hard-business.svg" alt="">
        <div class="text">
          <h1>Don't panic</h1>
          <p class="main">This walkthrough can make you familliar with all the factors that go in to making your SuperModel.</p>
          <p>Feel free to go through the guide and create your model that way or jump right in to the variables to start tweaking!</p>
        </div>
      </div>

      <div class="card with-figure">
        <article>
          <h2>Product or Subscription</h2>
          <p class="main">So, you've started a software company selling to consumers who pay:</p>

          <paper-radio-group selected="subscription">
            <paper-radio-button name="product" disabled>A one time purchase</paper-radio-button>
            <paper-radio-button name="subscription">A monthly subscription</paper-radio-button>
          </paper-radio-group>

          <p>Congratulations! Subscription models are favored by many for their predictable recurring revenue streams and high margins. But they operate in unique ways, and you’ll need to understand the core customer logic in order to achieve optimal financial results.</p>

          <p>The goal of a subscription company is to retain a large percentage of subscribers.</p>
        </article>
        <figure>
          <img src="/src/products.svg" alt="Products">
        </figure>
      </div>

      <div class="card with-figure">
        <article>
          <h2>Pricing</h2>
          <p>Ok, let’s start with setting the price of your product per month. We use Simoleans (§) as the currency in this model.</p>
          <p>This is of course the foundation value in your model. For a free tier, set one to §0.</p>

          <div class="tiers">
            <div class="group">
              <h3>Tier 1</h3>
              <paper-input value="{{data.pricePerMonthT1}}" type="number" label="Price per month">
                <span slot="prefix">§</span>
              </paper-input>
              <paper-input value="{{data.pricePercentT1}}" type="number" label="Percentage out of total">
                <span slot="suffix">%</span>
              </paper-input>
            </div>
            <div class="group">
              <h3>Tier 2</h3>
              <paper-input value="{{data.pricePerMonthT2}}" type="number" label="Price per month">
                <span slot="prefix">§</span>
              </paper-input>
              <paper-input value="{{data.pricePercentT2}}" type="number" label="Percentage out of total">
                <span slot="suffix">%</span>
              </paper-input>
            </div>
            <div class="group">
              <h3>Tier 3</h3>
              <paper-input value="{{data.pricePerMonthT3}}" type="number" label="Price per month">
                <span slot="prefix">§</span>
              </paper-input>
              <paper-input value="{{data.pricePercentT3}}" type="number" label="Percentage out of total">
                <span slot="suffix">%</span>
              </paper-input>
            </div>
          </div>

          <p>The point of a tool like SuperModel is that you can continue to play with these. When deciding how to set this price, take into consideration the market of existing competitive products and your sense for what the customer will be willing to pay.</p>
        </article>
        <div>
          <sum-customer-tiers-graph id="customer-tiers-graph" data="[[data]]"></sum-customer-tiers-graph>
        </div>
      </div>

      <div class="card with-figure">
        <article>
          <h2>Growing</h2>
          <p>Let's estimate the number of customers that you believe you can reasonably attain in the first month of your business.</p>

          <paper-input value="{{data.netNewCustomersStart}}" type="number" label="1st Month">
            <span slot="suffix">Customers</span>
          </paper-input>

          <p>And from there, how much growth do you expect in year one, from month to month?</p>
          <paper-input value="{{data.growthRate}}" type="number" label="Monthly growth">
            <span slot="suffix">%/month</span>
          </paper-input>
        </article>
        <div>
          <sum-multiple-lines-graph id="multiple-lines-graph" data="[[newCustomersDataToPlot]]" legend-labels='["New", "Retained", "Total"]'></sum-multiple-lines-graph>
        </div>
      </div>

      <div class="card with-figure">
        <article>
          <h2>Retention</h2>
          <p>What percentage of your customers do you think will be with you after 6 months. </p>
          <paper-input value="{{data.retentionRateSixMonths}}" type="number" label="Retention rate at 6 months">
            <span slot="suffix">%</span>
          </paper-input>
        </article>
        <div>
          <sum-one-line-graph id="retention-rate-graph" data="[[calculated.defaultRetentionPercentages]]" label="Retention rate" rgb-colors="[[retentionGraphColors]]"></sum-one-line-graph>
        </div>
      </div>

      <div class="report">
        <h2>Key Numbers</h2>
        <div>
          <div class="big-number">
            <h3>LTV</h3>
            <p class="number">
              <span class="prefix">§</span>{{_sumArrayValuesRound(calculated.traditionalLifetimeValue)}}
            </p>
          </div>
          <h3>Lifetime Value</h3>
          <p>A key number to track, this is the value you get from an individual customer over their entire use of your product.</p>
          <p>You can use this number when deciding on how much money you want to spend on marketing and to see when your retention rates are best.</p>
          <p>The number we calculated is the Traditional LTV.</p>
        </div>
        <div>
          <div class="big-number">
            <h3>Total Revenue</h3>
            <p class="number">
              <span class="prefix">§</span>{{_sumArrayValuesRound(calculated.totalRevenue)}}
            </p>
          </div>
          <h3>Revenue</h3>
          <p>All the money you're going to earn with this product in year 1.</p>
        </div>
      </div>

      <div class="card">
        <h2>Cost Of Goods Sold</h2>

        <div class="cats">

          <div class="group">
            <h3>Support</h3>
            <p>Employees dedicated to customer support of the software and customer success.</p>
            <paper-input value="{{data.staffServiceHumans}}" type="number" label="Employees">
              <span slot="suffix">people</span>
            </paper-input>
            <paper-input value="{{data.staffServiceHumansPrice}}" type="number" label="Wages">
              <span slot="prefix">§</span>
              <span slot="suffix">/year</span>
            </paper-input>
          </div>

          <div class="group">
            <h3>Techies</h3>
            <p>Employees required to keep the production environment running.</p>
            <paper-input value="{{data.staffInfrastructureHumans}}" type="number" label="Employees">
              <span slot="suffix">people</span>
            </paper-input>
            <paper-input value="{{data.staffInfrastructureHumanPrice}}" type="number" label="Wages">
              <span slot="prefix">§</span>
              <span slot="suffix">/year</span>
            </paper-input>
          </div>

          <div class="group">
            <h3>Other service staff</h3>
            <p>Employees required to deliver the ongoing service.</p>
            <paper-input value="{{data.staffDeliveryOtherHumans}}" type="number" label="Employees">
              <span slot="suffix">people</span>
            </paper-input>
            <paper-input value="{{data.staffDeliveryOtherHumanPrice}}" type="number" label="Wages">
              <span slot="prefix">§</span>
              <span slot="suffix">/year</span>
            </paper-input>
          </div>

          <div class="group">
            <h3>Tech</h3>
            <p>Hosting and tech infrastructure in the first year</p>
            <paper-input value="{{data.costInitialTech}}" type="number" label="Tech costs">
              <span slot="prefix">§</span>
            </paper-input>

            <p>Any third-party software or data that is included in your delivered product</p>
            <paper-input value="{{data.costMonthlyTech}}" type="number" label="Software">
              <span slot="prefix">§</span>
              <span slot="suffix">/month</span>
            </paper-input>
          </div>

        </div>

      </div>

      <div class="report">
        <h2>Key Numbers</h2>

        <div>
          <div class="big-number">
            <h3>Delivery Employees</h3>
            <p class="number">{{calculated.staffDeliveryTotalHumans}}</p>
          </div>
        </div>

        <div>
          <div class="big-number">
            <h3>Total COGS</h3>
            <p class="number">{{_sumArrayValuesRound(calculated.cogs)}}</p>
          </div>
        </div>

        <div>
          <div class="big-number">
            <h3>Gross Margin</h3>
            <p class="number">{{_sumArrayValuesRound(calculated.averageCustomerGrossMargin)}}</p>
          </div>
          <p>Profit %!</p>
        </div>

        <div>
          <div class="big-number">
            <h3>Customer Gross Margin</h3>
            <p class="number">{{_sumArrayValuesRound(calculated.averageCustomerGrossMargin)}}</p>
          </div>
        </div>

        <div>
          <div class="big-number">
            <h3>LTV</h3>
            <p class="number">{{_sumArrayValuesRound(calculated.traditionalLifetimeValue)}}</p>
          </div>
          <p>Based on your retention rates and total customer lifespan assumptions.</p>
        </div>

      </div>

      <div class="card">
        <h2>Operating Budget</h2>

        <div class="cats">
          <div class="group">
            <h3>Product employees</h3>
            <p>Employees involved in product development to keep your subscription product valuable and improving over time</p>
            <paper-input value="{{data.staffProductHumans}}" type="number" label="Employees">
              <span slot="suffix">people</span>
            </paper-input>
            <p>Employee salary:</p>
            <paper-input value="{{data.staffProductHumanPrice}}" type="number" label="Wages">
              <span slot="prefix">§</span>
              <span slot="suffix">/year</span>
            </paper-input>

          </div>
          <div class="group">
            <h3>Customer Success</h3>
            <p>How many employees will help retain customers ?</p>
            <paper-input value="{{data.staffSuccessHumans}}" type="number" label="Employees">
              <span slot="suffix">people</span>
            </paper-input>
            <p>Employee salary:</p>
            <paper-input value="{{data.staffSuccessHumanPrice}}" type="number" label="Wages">
              <span slot="prefix">§</span>
              <span slot="suffix">/year</span>
            </paper-input>

          </div>
          <div class="group">
            <h3>Costs</h3>
            <p></p>
            <paper-input value="{{data.costOfficePerHuman}}" type="number" label="Office space">
              <span slot="prefix">§</span>
              <span slot="suffix">/person</span>
            </paper-input>
            <p>What other supplies or materials</p>
            <paper-input value="{{data.costSupplies}}" type="number" label="Supplies">
              <span slot="prefix">§</span>
            </paper-input>
            <p>Third party software for use in-house (not as part of your product)</p>
            <paper-input value="{{data.costSoftware}}" type="number" label="Software">
              <span slot="prefix">§</span>
            </paper-input>
          </div>

        </div>
      </div>


      <div class="report">

        <h2>Key Numbers</h2>

        <div>
          <div class="big-number">
            <h3>Operating Costs</h3>
            <div class="number">{{_sumArrayValuesRound(calculated.totalOperatingCosts)}}</div>
            <p></p>
          </div>
        </div>
        <div>
          <div class="big-number">
            <h3></h3>
            <div class="number">{{_avgArrayValuesRound(calculated.averageCustomerGrossMargin)}} %</div>
            <p></p>
          </div>
        </div>
        <div>
          <div class="big-number">
            <h3>Total staff</h3>
            <div class="number">{{calculated.staffOperatingTotalHumans}}</div>
            <p></p>
          </div>
        </div>
        <div>
          <div class="big-number">
            <h3>Operating Margin (EBIT)</h3>
            <div class="number">{{_avgArrayValuesRound(calculated.netOperatingMargin)}} %</div>
            <p></p>
          </div>
        </div>

      </div>

      <div class="retention">
        <div class="text">
          <h2>Grow Forth</h2>
          <p class="main">Now you have all your numbers, and you know what they mean, what about opening the variables on your laptop and the overview on a big screen and play around with the numbers.</p>
        </div>
        <img src="/src/retention.svg" alt="You'll make new friends (and lose some too)">
      </div>
    </main>

  </template>

  <script>
    class SumGuide extends Polymer.Element {
      static get is() { return 'sum-guide'; }
      /**
       * Object describing property-related metadata used by Polymer features
       */
      static get properties() {
        return {
          data: {
            type: Object,
            notify: true
          },
          calculated: Object,
          newCustomersDataToPlot: {
            type: Array,
            computed: "_getNewCustomersData(calculated.*)"
          }
        };
      }

      _sumArrayValues(array) {
        if (array) return array.reduce((a, b) => a + b, 0);
      }
      _avgArrayValues(array) {
        if (array) return array.reduce((a, b) => a + b, 0) / array.length;
      }
      _sumArrayValuesRound(array) {
        return Math.round(this._sumArrayValues(array))
      }
      _avgArrayValuesRound(array) {
        return Math.round(this._avgArrayValues(array))
      }
      _getNewCustomersData(calculatedChanged) {
        var calculated = calculatedChanged.base;
        return [calculated.netNewCustomers, calculated.retainedCustomersTotal, calculated.totalCustomers];
      }
    }

    window.customElements.define(SumGuide.is, SumGuide);
  </script>
</dom-module>
